# Dixie BFF — Environment Configuration Template
# Copy to .env.staging (or .env) and fill in values.
# See app/src/config.ts for full documentation.
#
# WARNING: Never commit .env files with real credentials.
# Use Docker secrets or CI secret stores for staging/production.

# ══════════════════════════════════════════════════
# REQUIRED — service will not start without these
# ══════════════════════════════════════════════════

# loa-finn backend URL (inference API)
FINN_URL=http://loa-finn:3000

# HS256 secret for JWT signing — minimum 32 characters
# Generate with: openssl rand -base64 48
DIXIE_JWT_PRIVATE_KEY=change-me-minimum-32-characters-long

# ══════════════════════════════════════════════════
# PHASE 1: Core Configuration
# ══════════════════════════════════════════════════

# HTTP listen port (default: 3001)
DIXIE_PORT=3001

# Runtime environment: development | test | staging | production
# Controls InMemoryReputationStore fallback (only dev/test) and admin key requirement (production)
NODE_ENV=staging

# Structured log level: debug | info | warn | error (default: info)
LOG_LEVEL=info

# WebSocket URL for loa-finn streaming (default: derived from FINN_URL with ws:// scheme)
# FINN_WS_URL=ws://loa-finn:3000

# Comma-separated allowed CORS origins (default: http://localhost:{port})
DIXIE_CORS_ORIGINS=http://localhost:3001

# Path to allowlist JSON file (default: /data/allowlist.json)
DIXIE_ALLOWLIST_PATH=/data/allowlist.json

# Admin API key for /api/admin endpoints (required in production, empty rejects all admin calls)
DIXIE_ADMIN_KEY=change-me-staging-admin-key

# Max requests per minute per identity (default: 100)
DIXIE_RATE_LIMIT_RPM=100

# ══════════════════════════════════════════════════
# PHASE 2: Infrastructure Connections
# ══════════════════════════════════════════════════

# PostgreSQL connection string — enables persistent reputation store, governance stores, migrations
# Required in staging/production (InMemoryReputationStore not permitted)
DATABASE_URL=postgresql://dixie:${POSTGRES_PASSWORD}@postgres:5432/dixie

# Redis connection string — enables session cache, distributed rate limiting
# Rate limit backend auto-upgrades to redis when this is set
REDIS_URL=redis://redis:6379

# Max connections in PostgreSQL pool (integer, default: 10, max: 100)
DATABASE_POOL_SIZE=10

# NATS server URL — enables event bus for agent fleet communication
NATS_URL=nats://nats:4222

# OpenTelemetry collector endpoint — enables distributed tracing
# Set to null/empty to disable tracing (zero overhead when disabled)
OTEL_EXPORTER_OTLP_ENDPOINT=http://tempo:4317

# ══════════════════════════════════════════════════
# PHASE 2: Tuning & Cache TTLs
# ══════════════════════════════════════════════════

# Memory projection cache TTL in seconds (default: 300)
DIXIE_MEMORY_PROJECTION_TTL=300

# Max events per memory query (default: 100)
DIXIE_MEMORY_MAX_EVENTS=100

# Conviction tier cache TTL in seconds (default: 300)
# 5 minutes balances freshness (BGT staking changes are infrequent) against API load
DIXIE_CONVICTION_TIER_TTL=300

# BEAUVOIR personality cache TTL in seconds (default: 1800)
DIXIE_PERSONALITY_TTL=1800

# Autonomous permission cache TTL in seconds (default: 300)
DIXIE_AUTONOMOUS_PERMISSION_TTL=300

# Default autonomous budget in micro-USD (default: 100000 = $0.10)
DIXIE_AUTONOMOUS_BUDGET=100000

# Rate limit backend: memory | redis (default: memory, auto-upgrades to redis when REDIS_URL set)
# DIXIE_RATE_LIMIT_BACKEND=memory

# HMAC secret for schedule callback verification (empty rejects all callbacks in production)
# DIXIE_SCHEDULE_CALLBACK_SECRET=change-me-if-using-scheduled-callbacks
